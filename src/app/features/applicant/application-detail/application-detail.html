<!-- Reviewer/Admin Layout -->
<ng-container *ngIf="isReviewerView; else applicantLayout">
  <app-reviewer-layout>
    <ng-container *ngTemplateOutlet="applicationContent"></ng-container>
  </app-reviewer-layout>
</ng-container>

<!-- Applicant Layout -->
<ng-template #applicantLayout>
  <app-applicant-layout>
    <ng-container *ngTemplateOutlet="applicationContent"></ng-container>
  </app-applicant-layout>
</ng-template>

<!-- Shared Content Template -->
<ng-template #applicationContent>
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading application details...</p>
  </div>

  <!-- Error/Not Found State -->
  <div *ngIf="!isLoading && !application" class="error-container" style="padding: 40px; text-align: center;">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" style="margin-bottom: 16px;">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" y1="8" x2="12" y2="12"/>
      <line x1="12" y1="16" x2="12.01" y2="16"/>
    </svg>
    <h2 style="color: #1f2937; margin-bottom: 8px;">Application Not Found</h2>
    <p style="color: #6b7280; margin-bottom: 24px;">The application you're looking for could not be loaded.</p>
    <button class="btn-primary" (click)="goBack()" style="padding: 10px 24px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
      Go Back
    </button>
  </div>

  <!-- Application Details -->
  <div *ngIf="!isLoading && application" class="detail-container">
    <!-- Header Section -->
    <div class="detail-header">
      <button class="btn-back" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Back to Applications
      </button>

      <div class="header-content">
        <div class="header-left">
          <div class="title-row">
            <h1>{{ application.formData?.roadName }}</h1>
            <span class="priority-badge" [class]="'priority-' + getPriority().level">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              {{ getPriority().label }} Priority
            </span>
          </div>
          <div class="meta-row">
            <p class="reference">{{ application.applicationNumber }}</p>
            <span class="time-in-review">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              {{ getTimeInReview() }} in review
            </span>
          </div>
          <span class="status-badge" [class]="getStatusClass(application.status)">
            {{ getStatusLabel(application.status) }}
          </span>
        </div>
        <div class="header-actions">
          <button class="btn-secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Download Report
          </button>
          <button class="btn-primary" *ngIf="!isReviewerView">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit Application
          </button>
        </div>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs">
      <button
        class="tab"
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
        Overview
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'workflow'"
        (click)="setActiveTab('workflow')"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
        </svg>
        Approval Workflow
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'documents'"
        (click)="setActiveTab('documents')"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
        Documents
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'comments'"
        (click)="setActiveTab('comments')"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        Comments
        <span class="badge">{{ comments.length }}</span>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="overview-content">
        <!-- Application Information - Full Width -->
        <div class="info-card full-width">
          <div class="card-header">
            <h3>Application Information</h3>
          </div>
          <div class="card-body">
            <div class="info-grid">
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Road Name</label>
                  <p>{{ application.formData?.roadName }}</p>
                </div>
              </div>
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Reference Number</label>
                  <p>{{ application.applicationNumber }}</p>
                </div>
              </div>
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Route</label>
                  <p>{{ application.formData?.startingPoint }} to {{ application.formData?.terminalPoint }}</p>
                </div>
              </div>
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Road Length</label>
                  <p>{{ application.formData?.roadLength }} km</p>
                </div>
              </div>
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Submitted Date</label>
                  <p>{{ application.submissionDate | date:'medium' }}</p>
                </div>
              </div>
              <div class="info-group">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                  </svg>
                </div>
                <div class="info-content">
                  <label>Last Updated</label>
                  <p>{{ application.updatedAt | date:'medium' }}</p>
                </div>
              </div>
            </div>

            <!-- Classification Details -->
            <div class="classification-visual">
              <h4 class="classification-title">Classification Change</h4>
              <div class="classification-wrapper">
                <div class="class-box current">
                  <div class="class-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <rect x="3" y="3" width="18" height="18" rx="2"/>
                      <line x1="9" y1="9" x2="15" y2="15"/>
                      <line x1="15" y1="9" x2="9" y2="15"/>
                    </svg>
                  </div>
                  <span class="class-label">Current Classification</span>
                  <span class="class-value">{{ formatClassification(application.formData?.currentClass || '') }}</span>
                  <span class="status-tag current-tag">Current</span>
                </div>

                <div class="arrow-divider">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <polyline points="12 5 19 12 12 19"/>
                  </svg>
                </div>

                <div class="class-box proposed">
                  <div class="class-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                  </div>
                  <span class="class-label">Proposed Classification</span>
                  <span class="class-value">{{ formatClassification(application.formData?.proposedClass || '') }}</span>
                  <span class="status-tag proposed-tag">Proposed</span>
                </div>
              </div>

              <!-- Classification Comparison Table -->
              <div class="criteria-comparison">
                <h5 class="comparison-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                  </svg>
                  Criteria Comparison
                </h5>
                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Criteria</th>
                      <th>{{ formatClassification(application.formData?.currentClass || '') }}</th>
                      <th>{{ formatClassification(application.formData?.proposedClass || '') }}</th>
                      <th>Road Specs</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Min. Carriageway Width</td>
                      <td>{{ getCriteria(application.formData?.currentClass || '').minWidth }}m</td>
                      <td>{{ getCriteria(application.formData?.proposedClass || '').minWidth }}m</td>
                      <td [class.meets-criteria]="(application.formData?.carriagewayWidth || 0) >= getCriteria(application.formData?.proposedClass || '').minWidth"
                          [class.below-criteria]="(application.formData?.carriagewayWidth || 0) < getCriteria(application.formData?.proposedClass || '').minWidth">
                        {{ application.formData?.carriagewayWidth }}m
                        <svg *ngIf="(application.formData?.carriagewayWidth || 0) >= getCriteria(application.formData?.proposedClass || '').minWidth" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                          <polyline points="20 6 9 17 4 12"/>
                        </svg>
                      </td>
                    </tr>
                    <tr>
                      <td>Min. Road Length</td>
                      <td>{{ getCriteria(application.formData?.currentClass || '').minLength }}km</td>
                      <td>{{ getCriteria(application.formData?.proposedClass || '').minLength }}km</td>
                      <td [class.meets-criteria]="(application.formData?.roadLength || 0) >= getCriteria(application.formData?.proposedClass || '').minLength"
                          [class.below-criteria]="(application.formData?.roadLength || 0) < getCriteria(application.formData?.proposedClass || '').minLength">
                        {{ application.formData?.roadLength }}km
                        <svg *ngIf="(application.formData?.roadLength || 0) >= getCriteria(application.formData?.proposedClass || '').minLength" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                          <polyline points="20 6 9 17 4 12"/>
                        </svg>
                      </td>
                    </tr>
                    <tr>
                      <td>Traffic Level</td>
                      <td>{{ getCriteria(application.formData?.currentClass || '').trafficLevel }}</td>
                      <td>{{ getCriteria(application.formData?.proposedClass || '').trafficLevel }}</td>
                      <td>{{ application.formData?.trafficLevel || '-' }}</td>
                    </tr>
                  </tbody>
                </table>
                <div class="criteria-verdict" [class.meets]="meetsProposedCriteria()" [class.below]="!meetsProposedCriteria()">
                  <svg *ngIf="meetsProposedCriteria()" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  <svg *ngIf="!meetsProposedCriteria()" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <span *ngIf="meetsProposedCriteria()">Road meets proposed classification criteria</span>
                  <span *ngIf="!meetsProposedCriteria()">Road may not meet all proposed classification criteria</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Road Details & Justification -->
        <div class="info-card full-width">
          <div class="card-header">
            <h3>Road Details & Justification</h3>
          </div>
          <div class="card-body">
            <div class="info-group">
              <div class="info-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10 9 9 9 8 9"/>
                </svg>
              </div>
              <div class="info-content">
                <label>Road Specifications</label>
                <p>Surface: {{ application.formData?.surfaceTypeCarriageway }} | Carriageway Width: {{ application.formData?.carriagewayWidth }}m | Formation Width: {{ application.formData?.formationWidth }}m</p>
              </div>
            </div>
            <div class="info-group">
              <div class="info-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              </div>
              <div class="info-content">
                <label>Reclassification Reasons</label>
                <p>{{ application.formData?.reclassificationReasons }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Workflow Tab -->
      <div *ngIf="activeTab === 'workflow'" class="workflow-content">
        <div class="workflow-card">
          <div class="card-header">
            <h3>Approval Timeline</h3>
            <p>Track your application through each review stage</p>
          </div>
          <div class="card-body">
            <div class="timeline">
              <div
                *ngFor="let step of approvalSteps; let i = index"
                class="timeline-item"
                [class.completed]="step.status === 'completed'"
                [class.current]="step.status === 'current'"
                [class.pending]="step.status === 'pending'"
              >
                <div class="timeline-marker">
                  <div class="marker-dot">
                    <svg *ngIf="step.status === 'completed'" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    <span *ngIf="step.status === 'current'">{{ i + 1 }}</span>
                    <span *ngIf="step.status === 'pending'">{{ i + 1 }}</span>
                  </div>
                  <div class="marker-line" *ngIf="i < approvalSteps.length - 1"></div>
                </div>
                <div class="timeline-content">
                  <div class="content-header">
                    <h4>{{ step.level }}</h4>
                    <span class="status-label" [class]="step.status">
                      {{ step.status === 'completed' ? 'Completed' : step.status === 'current' ? 'In Progress' : 'Pending' }}
                    </span>
                  </div>
                  <p class="reviewer">{{ step.reviewer }}</p>
                  <p class="date" *ngIf="step.date">{{ step.date | date:'medium' }}</p>
                  <div class="decision" *ngIf="step.decision">
                    <span class="decision-badge" [class]="step.decision">
                      {{ step.decision === 'approved' ? 'Approved' : step.decision === 'rejected' ? 'Rejected' : 'Changes Required' }}
                    </span>
                  </div>
                  <div class="step-comments" *ngIf="step.comments">
                    <p>{{ step.comments }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Documents Tab -->
      <div *ngIf="activeTab === 'documents'" class="documents-content">
        <div class="documents-split-view">
          <!-- Documents List Panel -->
          <div class="documents-list-panel" [class.collapsed]="selectedDocument">
            <div class="panel-header">
              <h3>Application Documents</h3>
              <button class="btn-primary-sm">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Upload
              </button>
            </div>
            <div class="documents-list">
              <div
                *ngFor="let doc of documents"
                class="document-item"
                [class.active]="selectedDocument?.name === doc.name"
                (click)="viewDocument(doc)"
              >
                <div class="doc-icon" [class.pdf]="doc.type === 'pdf'" [class.zip]="doc.type === 'zip'">
                  <svg *ngIf="doc.type === 'pdf'" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                  </svg>
                  <svg *ngIf="doc.type === 'zip'" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <div class="doc-info">
                  <h4>{{ doc.name }}</h4>
                  <p>{{ doc.size }} • {{ doc.type.toUpperCase() }} • {{ doc.date }}</p>
                </div>
                <div class="doc-actions">
                  <button class="btn-icon view" *ngIf="doc.type === 'pdf'" title="View">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  </button>
                  <button class="btn-icon download" (click)="downloadDocument(doc.name); $event.stopPropagation()" title="Download">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7 10 12 15 17 10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Document Viewer Panel -->
          <div class="document-viewer-panel" [class.active]="selectedDocument">
            <div *ngIf="!selectedDocument" class="viewer-placeholder">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
              </svg>
              <h4>Select a document to preview</h4>
              <p>Click on any PDF document from the list to view it here</p>
            </div>

            <div *ngIf="selectedDocument" class="viewer-content">
              <div class="viewer-header">
                <div class="viewer-title">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                  <span>{{ selectedDocument.name }}</span>
                </div>
                <div class="viewer-actions">
                  <button class="btn-icon" (click)="downloadDocument(selectedDocument.name)" title="Download">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7 10 12 15 17 10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                  </button>
                  <button class="btn-icon" (click)="closeDocumentViewer()" title="Close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="18" y1="6" x2="6" y2="18"/>
                      <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="viewer-iframe-container">
                <iframe
                  [src]="selectedDocument.url | safe:'resourceUrl'"
                  type="application/pdf"
                  width="100%"
                  height="100%"
                ></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Comments Tab -->
      <div *ngIf="activeTab === 'comments'" class="comments-content">
        <div class="comments-card">
          <div class="card-header">
            <h3>Discussion Thread</h3>
            <p>{{ comments.length }} {{ comments.length === 1 ? 'message' : 'messages' }} in conversation</p>
          </div>
          <div class="card-body">
            <!-- Comment List - Chat Style -->
            <div class="comments-thread">
              <div *ngIf="comments.length === 0" class="no-comments">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                <p>No comments yet. Start the conversation!</p>
              </div>
              <div *ngFor="let comment of comments; let i = index" class="comment-bubble" [class.same-author]="i > 0 && comments[i-1].author === comment.author">
                <div class="bubble-avatar" *ngIf="i === 0 || comments[i-1].author !== comment.author">
                  <span class="avatar-initial">{{ comment.author.charAt(0) }}</span>
                </div>
                <div class="bubble-content">
                  <div class="bubble-meta" *ngIf="i === 0 || comments[i-1].author !== comment.author">
                    <span class="author-name">{{ comment.author }}</span>
                    <span class="author-role">{{ comment.role }}</span>
                  </div>
                  <div class="bubble-message">
                    <p>{{ comment.content }}</p>
                    <span class="bubble-time">{{ comment.timestamp | date:'short' }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Add Comment Form - Chat Input Style -->
            <div class="chat-input-container">
              <div class="chat-input">
                <textarea
                  [(ngModel)]="newComment"
                  placeholder="Type your message..."
                  rows="1"
                ></textarea>
                <button class="send-btn" (click)="addComment()" [disabled]="!newComment.trim()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                  </svg>
                </button>
              </div>
              <p class="chat-hint">Click the send button to post your message</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Bar for Reviewers -->
    <div *ngIf="isReviewerView" class="floating-action-bar">
      <div class="action-bar-content">
        <div class="action-bar-info">
          <span class="app-ref">{{ application.applicationNumber }}</span>
          <span class="app-status" [class]="getStatusClass(application.status)">{{ getStatusLabel(application.status) }}</span>
        </div>
        <div class="action-bar-buttons">
          <button class="action-btn info" (click)="onRequestInfo()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Request Info
          </button>
          <button class="action-btn reject" (click)="onReject()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            Reject
          </button>
          <button class="action-btn approve" (click)="onApprove()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>
